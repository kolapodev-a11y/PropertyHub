<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register — PropertyHub</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/auth.css" />
</head>
<body class="auth-page">

<!-- LEFT PANEL -->
<div class="auth-left">
  <div class="auth-left-content">
    <a href="index.html" class="auth-left-logo">
      <svg viewBox="0 0 40 40" fill="none" style="width:36px;height:36px;"><rect width="40" height="40" rx="10" fill="rgba(255,255,255,0.2)"/><path d="M20 8L8 18V32H16V24H24V32H32V18L20 8Z" fill="white"/></svg>
      Property<span>Hub</span>
    </a>
    <h2>Join PropertyHub</h2>
    <p>Create a free account to start buying, selling or renting properties and second-hand phones today.</p>
    <ul class="auth-features">
      <li><span class="check">✓</span> Free to join & post listings</li>
      <li><span class="check">✓</span> Upload up to 10 photos per listing</li>
      <li><span class="check">✓</span> Pin your property on Google Maps</li>
      <li><span class="check">✓</span> Reach thousands of buyers</li>
    </ul>
  </div>
</div>

<!-- RIGHT PANEL -->
<div class="auth-right">
  <div class="auth-card">
    <div class="auth-card-header">
      <h1>Create Account</h1>
      <p>Already have an account? <a href="login.html">Sign in</a></p>
    </div>

    <div class="auth-alert auth-alert-error" id="reg-alert"></div>
    <div class="auth-alert auth-alert-success" id="reg-success"></div>

    <!-- Google Sign Up -->
    <button class="btn-google" id="google-signup-btn">
      <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" />
      Sign up with Google
    </button>

    <div class="auth-divider">or sign up with email</div>

    <!-- Email Form -->
    <form id="register-form" novalidate>
      <div class="form-group">
        <label class="form-label" for="reg-name">Full Name <span style="color:red">*</span></label>
        <div class="input-with-icon">
          <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          <input type="text" id="reg-name" class="form-input" placeholder="John Doe" required />
        </div>
        <div class="form-error" id="name-error">Full name is required.</div>
      </div>

      <div class="form-group">
        <label class="form-label" for="reg-email">Email Address <span style="color:red">*</span></label>
        <div class="input-with-icon">
          <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,12 2,6"/></svg>
          <input type="email" id="reg-email" class="form-input" placeholder="you@email.com" required />
        </div>
        <div class="form-error" id="email-error">Please enter a valid email.</div>
      </div>

      <div class="form-group">
        <label class="form-label" for="reg-password">Password <span style="color:red">*</span></label>
        <div class="input-with-icon">
          <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          <input type="password" id="reg-password" class="form-input" placeholder="Min 6 characters" required />
          <button type="button" class="toggle-password" id="toggle-pw">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="eye-icon"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
        </div>
        <div class="form-error" id="pw-error">Password must be at least 6 characters.</div>
        <!-- Password strength -->
        <div id="pw-strength" style="margin-top:8px; display:none;">
          <div style="display:flex; gap:4px; margin-bottom:4px;">
            <div class="pw-bar" style="height:4px; flex:1; border-radius:2px; background:#e2e8f0;"></div>
            <div class="pw-bar" style="height:4px; flex:1; border-radius:2px; background:#e2e8f0;"></div>
            <div class="pw-bar" style="height:4px; flex:1; border-radius:2px; background:#e2e8f0;"></div>
            <div class="pw-bar" style="height:4px; flex:1; border-radius:2px; background:#e2e8f0;"></div>
          </div>
          <span id="pw-label" style="font-size:.75rem; color:var(--text-muted);"></span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="reg-confirm">Confirm Password <span style="color:red">*</span></label>
        <div class="input-with-icon">
          <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          <input type="password" id="reg-confirm" class="form-input" placeholder="Repeat password" required />
        </div>
        <div class="form-error" id="confirm-error">Passwords do not match.</div>
      </div>

      <button type="submit" class="btn-auth" id="register-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
        Create Free Account
      </button>
    </form>

    <p class="terms-text">By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>

    <div class="auth-footer">
      Already have an account? <a href="login.html">Sign in here</a>
    </div>
  </div>
</div>

<script type="module">
  import { registerWithEmail, loginWithGoogle, watchAuthState } from "./js/auth.js";

  // Redirect if already logged in
  watchAuthState((user) => {
    if (user) window.location.href = "index.html";
  });

  const alertEl   = document.getElementById("reg-alert");
  const successEl = document.getElementById("reg-success");
  const regBtn    = document.getElementById("register-btn");

  function showAlert(msg) {
    alertEl.textContent = msg; alertEl.classList.add("visible");
    successEl.classList.remove("visible");
  }
  function showSuccess(msg) {
    successEl.textContent = msg; successEl.classList.add("visible");
    alertEl.classList.remove("visible");
  }
  function hideAlerts() {
    alertEl.classList.remove("visible");
    successEl.classList.remove("visible");
  }

  // Password toggle
  const pwInput  = document.getElementById("reg-password");
  const eyeToggle = document.getElementById("toggle-pw");
  eyeToggle.addEventListener("click", () => {
    pwInput.type = pwInput.type === "password" ? "text" : "password";
  });

  // Password strength
  pwInput.addEventListener("input", () => {
    const val = pwInput.value;
    const strengthEl = document.getElementById("pw-strength");
    const labelEl    = document.getElementById("pw-label");
    const bars       = document.querySelectorAll(".pw-bar");
    if (!val) { strengthEl.style.display = "none"; return; }
    strengthEl.style.display = "block";
    let score = 0;
    if (val.length >= 6)  score++;
    if (val.length >= 10) score++;
    if (/[A-Z]/.test(val) && /[0-9]/.test(val)) score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;
    const colors = ["#EF4444","#F59E0B","#3B82F6","#22C55E"];
    const labels = ["Weak","Fair","Good","Strong"];
    bars.forEach((b, i) => b.style.background = i < score ? colors[score-1] : "#e2e8f0");
    labelEl.textContent  = labels[score-1] || "";
    labelEl.style.color  = colors[score-1] || "var(--text-muted)";
  });

  // Register form
  document.getElementById("register-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    hideAlerts();
    const name     = document.getElementById("reg-name").value.trim();
    const email    = document.getElementById("reg-email").value.trim();
    const password = document.getElementById("reg-password").value;
    const confirm  = document.getElementById("reg-confirm").value;

    if (!name)              { showAlert("Full name is required.");    return; }
    if (!email)             { showAlert("Email is required.");        return; }
    if (password.length < 6){ showAlert("Password min 6 characters.");return; }
    if (password !== confirm){ showAlert("Passwords do not match.");   return; }

    regBtn.disabled    = true;
    regBtn.textContent = "Creating account…";
    try {
      await registerWithEmail(name, email, password);
      showSuccess("Account created! Redirecting…");
      setTimeout(() => { window.location.href = "index.html"; }, 1500);
    } catch (err) {
      let msg = "Registration failed.";
      if (err.code === "auth/email-already-in-use") msg = "Email already registered. Try logging in.";
      if (err.code === "auth/invalid-email")        msg = "Invalid email address.";
      if (err.code === "auth/weak-password")        msg = "Password is too weak.";
      showAlert(msg);
      regBtn.disabled    = false;
      regBtn.textContent = "Create Free Account";
    }
  });

  // Google sign up
  document.getElementById("google-signup-btn").addEventListener("click", async () => {
    hideAlerts();
    try {
      await loginWithGoogle();
      window.location.href = "index.html";
    } catch (err) {
      showAlert("Google sign-up failed. Please try again.");
    }
  });
</script>
</body>
</html>
